load("@bazel_skylib//rules:run_binary.bzl", "run_binary")
load("//python/venv:defs.bzl", "py_venv_binary", "py_venv_test")

py_venv_binary(
    name = "data_writer",
    srcs = ["data_writer.py"],
    data = [
        "data file.txt",
    ],
    deps = [
        "//python/runfiles",
    ],
)

run_binary(
    name = "generated_data",
    srcs = ["data file.txt"],
    outs = ["generated data.txt"],
    args = [
        "--data",
        "$(rlocationpath data file.txt)",
        "--output",
        "$(execpath generated data.txt)",
    ],
    tool = ":data_writer",
)

py_venv_test(
    name = "data_test",
    srcs = ["data_test.py"],
    data = [
        "data file.txt",
        ":generated_data",
    ],
    env = {
        "DATA_FILE": "$(rlocationpath data file.txt)",
        "GENERATED_DATA": "$(rlocationpath :generated_data)",
    },
    deps = [
        "//python/runfiles",
    ],
)
